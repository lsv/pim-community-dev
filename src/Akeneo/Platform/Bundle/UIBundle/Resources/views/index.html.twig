<!DOCTYPE html>
<html>
    <head>
        <title>Loading...</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="favicon.ico" />

        <link rel="stylesheet" href="{{asset('css/pim.css', 'frontend')}}"/>

        {{ external_javascript_dependencies() }}
        <script type="text/javascript" src="{{asset('dist/vendor.min.js', 'frontend')}} "></script>
        <script type="text/javascript" src="{{asset('dist/main.min.js', 'frontend')}} "></script>
    </head>
    <body>
        <div class="app">
            <div class="AknDefault-progressContainer">
                <h3>
                    Loading ...
                </h3>
                <img src="{{ asset('bundles/pimui/images/main-loader.gif') }}"/>
                {% if true == oro_config_value('pim_ui.loading_message_enabled') %}
                <h4 class="AknDefault-progressContainer--loadingMessages">
                    {{ random(oro_config_value('pim_ui.loading_messages')|split('\n')) }}
                </h4>
                {% endif %}
            </div>
        </div>
        <div class="hash-loading-mask"></div>
        <script>
          function initSubsectionToggler($) {
            if ($('.entity-edit-form .tab-pane.active.object-values .AknSubsection > div').length) {
              $('.entity-edit-form .tab-pane.active.object-values .AknSubsection > div').addClass('hide');

              $('.entity-edit-form .tab-pane.active.object-values .AknSubsection > header > .group-label').each(function () {
                const $label = $(this);
                if (!$label.data('click-handler-attached')) {
                  $label
                    .css('cursor', 'pointer')
                    .on('click', function (e) {
                      e.preventDefault();
                      const div = $(e.currentTarget).parent().next();
                      div.toggleClass('hide');
                    });
                  $label.data('click-handler-attached', true);
                }
              });
            }
          }

          jQuery(function($) {
            let lastUrl = location.href;

            function checkUrlChange() {
              const currentUrl = location.href;
              if (currentUrl !== lastUrl) {
                lastUrl = currentUrl;
                initSubsectionToggler($);
              }
            }

            // Run initially
            initSubsectionToggler($);

            // Poll for URL changes every 500ms
            setInterval(checkUrlChange, 500);
          });
        </script>
    </body>
</html>
